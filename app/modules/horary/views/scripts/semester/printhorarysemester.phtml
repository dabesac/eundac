<?php
$dir = APPLICATION_LIBRARY."/pdf/MPDF57/mpdf.php";
include_once($dir);
ob_start();
?>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />  
<link rel="stylesheet" type="text/css" href="/css/print.css">

<div style="text-align: center; font-size:16px;margin-top:10px">
    <b> HORARIO <?php echo strtoupper($this->semid)?>º SEMESTRE  &nbsp;&nbsp;<?php if ($this->turno) {
       echo "TURNO ".$this->turno;
   }?>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
   PERIODO <?php echo strtoupper($this->perid)?></b>
</div> 
<br/>
<?php 
    $hora=array();  
    $hour_begin=array();
    if ($this->valhorasm or $this->valhorast) {
        $j=1;
        $hour_begin=$this->valhorasm;
        $hour_begin_afternoon=$this->valhorast;
        $len1= count($hour_begin);
        $len2= count($hour_begin_afternoon);
        $lentotal = $len1+$len2;
    
        for ($i=0; $i < $len1; $i++) { 
            $hourm[$i]=substr($hour_begin[$i],0,2);
            $minutem[$i]=substr($hour_begin[$i],3,2);
        }
        for ($i=0; $i < $len2; $i++) { 
            $hourt[$i]=substr($hour_begin_afternoon[$i],0,2);
            $minutet[$i]=substr($hour_begin_afternoon[$i],3,2);
        }
        for ($i=0; $i < $len1-1; $i++) {
            if ($hourm[$i]) {
                if ($hourm[$i]<12) {
                    if ($hourm[$j]<12) {
                        $hora[$i]['hora']=$hourm[$i].":".$minutem[$i]." am - ".$hourm[$j].":".$minutem[$j]." am";
                    }
                    else{
                        $hora[$i]['hora']=$hourm[$i].":".$minutem[$i]." am - ".$hourm[$j].":".$minutem[$j]." pm";
                    }
                } 
                else{
                    $hora[$i]['hora']=$hourm[$i].":".$minutem[$i]." pm - ".$hourm[$j].":".$minutem[$j]." pm";
                }
                $hora[$i]['h_ini']=$hourm[$i];
                $hora[$i]['h_fin']=$hourm[$j];
                $hora[$i]['m_ini']=$minutem[$i];
                $hora[$i]['m_fin']=$minutem[$j];
                $j++;            
            }

        }

        $q=1;
        for ($p=0; $p < $len2; $p++) {
            if ($hourt[$p]) {
                if ($hourt[$p]<12) {
                    if ($hourt[$q]<12) {
                        $hora[$i]['hora']=$hourt[$p].":".$minutet[$p]." am - ".$hourt[$q].":".$minutet[$q]." am";
                    }
                    else{
                        $hora[$i]['hora']=$hourt[$p].":".$minutet[$p]." am - ".$hourt[$q].":".$minutet[$q]." pm";
                    }
                } 
                else{
                    $hora[$i]['hora']=$hourt[$p].":".$minutet[$p]." pm - ".$hourt[$q].":".$minutet[$q]." pm";
                }
                $hora[$i]['h_ini']=$hourt[$p];
                $hora[$i]['h_fin']=$hourt[$q];
                $hora[$i]['m_ini']=$minutet[$p];
                $hora[$i]['m_fin']=$minutet[$q];
                $q++;
                $i++;            
            }
        }
    }
    else{
        $j=1;
        $hour_begin=$this->valhoras;
        $len= count($hour_begin);
        $lentotal=$len;
        for ($i=0; $i < $len; $i++) { 
            $hour[$i]=substr($hour_begin[$i],0,2);
            $minute[$i]=substr($hour_begin[$i],3,2);
        }
        for ($i=0; $i < $len; $i++) {
            if ($hour[$i]) {
                if ($hour[$i]<12) {
                    if ($hour[$j]<12) {
                        $hora[$i]['hora']=$hour[$i].":".$minute[$i]." am - ".$hour[$j].":".$minute[$j]." am";
                    }
                    else{
                        $hora[$i]['hora']=$hour[$i].":".$minute[$i]." am - ".$hour[$j].":".$minute[$j]." pm";
                    }
                } 
                else{
                    $hora[$i]['hora']=$hour[$i].":".$minute[$i]." pm - ".$hour[$j].":".$minute[$j]." pm";
                }
                $hora[$i]['h_ini']=$hour[$i];
                $hora[$i]['h_fin']=$hour[$j];
                $hora[$i]['m_ini']=$minute[$i];
                $hora[$i]['m_fin']=$minute[$j];
                $j++;            
            }
        }
    }

    $listacolores = array();
    $listacolores[0] = "#FA8D74";
    $listacolores[1] = "#A3CFE0";
    $listacolores[2] = "#CBE487";
    $listacolores[3] = "#FAF48D";
    $listacolores[4] = "#FCB16B";
    $listacolores[5] = "#CCF0EE";
    $listacolores[6] = "#DFDFDF";
    $listacolores[7] = "#81FF86";
    $listacolores[8] = "#CD88FD";
    $listacolores[9] = "#F59FFC";
    $listacolores[10] = "#A58CFF";
    $listacolores[11] = "#F2BBBB";
    $listacolores[12] = "#D8BADA";
    $listacolores[13] = "#C4E6CE";
    $listacolores[14] = "#B4DAA1";
?>
<link rel="stylesheet" type="text/css" href="/css/print.css">
<style type="text/css">
.cajatitulo{
        width:13%;
        height: 25px;
        line-height: 25px;
        text-align: center;
        border-radius: 5px;  
        margin-bottom: 10px;
        font-family: Arial;
        font-size:12px;
        border: 1px solid #343434;
        box-shadow: 0px 0px 5px #343434;
        float:left;
        margin-left: 1%;
    }
    .cajita{
        height: 20px;
        text-align: center;
        border-radius: 5px;  
        margin-bottom: 4px;
        border: 1px solid #343434;
        font-family: Arial;
        font-size:12px;
        float:left;
    }
    .nomdoc{   
        height: 30px;
        line-height: 30px;
        text-align: center;
        border-radius: 5px;
        margin-bottom: 2%;
        font-family: Arial;
        font-size:12px;
        border: 1px solid rgb(212, 212, 212);
        box-shadow: 0px 0px 5px #343434;
    }
    .cajacursos{
        height: 20px;
        text-align: center;
        border-radius: 5px;  
        margin-bottom: 4px;
        border: 1px solid #343434;
        font-family: Arial;
        font-size:12px;
        float:left;
    }
</style>
    
<?php
if ($this->horarys) {
        $len=count($this->horarys);
        $cco=0;
        $hmen=13;
        $hmay=13;
        for ($i=0; $i < $len;$i++){
        
            $rid=substr($this->horarys[$i]['teach_uid'],8,2);
            if ($rid=='JP') $this->horarys[$i]['practica']='(P)';
            else{
                $this->horarys[$i]['practica']="";
                if ($this->horarys[$i]['type_class']=='P') {
                    $this->horarys[$i]['abbreviation']=$this->horarys[$i]['abbreviation']." (P)";
                }                
            } 

            $codcurso=$this->horarys[$i]['courseid'];
            $tturno=$this->horarys[$i]['turno'];
            $codcursodes=$this->horarys[$i+1]['courseid'];
            $tturnodes=$this->horarys[$i+1]['turno'];

            if($codcurso==$codcursodes && $tturno==$tturnodes){
                $this->horarys[$i]['color']=$listacolores[$cco];
            }
            else{
                $this->horarys[$i]['color']=$listacolores[$cco];
                // $this->dcurso[$cc]['color']=$listacolores[$cco];
                $cco++;
            }
            $hsplit=split(":",$this->horarys[$i]['hora_ini']);
            $hi=$hsplit[0];
            $hsplit=split(":", $this->horarys[$i]['hora_fin']);
            $hf=$hsplit[0];
            if($hi<=$hmen) $hmen=$hi;
            if($hf>=$hmay) $hmay=$hf;
            
        }
        $k=0;
        if ($hour_begin) {
            for ($z=0; $z < $lentotal; $z++) { 
                if ($hmen==$hora[$z]['h_ini'] && $k==0) {
                    $inih=$z;
                    $k=1;
                }
                if ($hmay==$hora[$z]['h_fin']) {
                    $finh=$z;
                }
            }
        }
        $horaoriginal=$this->horarys;
        // print_r($this->dcurso);exit();
?>
<div style="width:100%">
    <div id='encabezado'>
        <div class='cajatitulo'><b>Hora:</b></div>
        <div class='cajatitulo'><b>Lunes</b></div>
        <div class='cajatitulo'><b>Martes</b></div>
        <div class='cajatitulo'><b>Miercoles</b></div>
        <div class='cajatitulo'><b>Jueves</b></div>
        <div class='cajatitulo'><b>Viernes</b></div>
        <div class='cajatitulo'><b>Sábado</b></div>
    </div>
    <div style="float: left; width:13.3%; margin-left:0.9%">
        <?php
        for ($h=$inih; $h <= $finh ; $h++) { ?> 
            <div class='cajita'><?php echo $hora[$h]['hora']?></div>
        <?php   
        }
        ?>
    </div>
    <div style="float: left; width:13.3%; margin-left:0.9%">
        <?php
        for ($i=$inih; $i <=$finh ; $i++) { 
            $band=0;
            $c=0;
            $dat=$this->horarys;
            // print_r($dat); exit();
            for ($s=0; $s < $len ; $s++) { 
                $hsplit=split(":",$dat[$s]['hora_ini']);
                $h=$hsplit[0];
                $m=$hsplit[1];
                $dia=$dat[$s]['day'];
                
                if ($dia==1){
                    if ($this->horarys[$s]['hora_ini']!=$this->horarys[$s]['hora_fin']){
                        if($hora[$i]['h_ini']==$h && $hora[$i]['m_ini']==$m){
                            $this->horarys[$s]['hora_ini']=$hora[$i]['h_fin'].':'.$hora[$i]['m_fin'].':00';
                            // exit();  
                            ?>
                            <div class='cajita' style='background-color:<?php echo $dat[$s]['color']?>'><?php echo $dat[$s]['abbreviation'].$dat[$s]['practica']?><span style="float:right; margin-right:1%"> (<?php echo $dat[$s]['turno']?>)</span></div>
                            <?php
                            $c++;
                        } else {
                            $band=1;
                        }
                    }
                } else {
                    $band=1;
                }
            }
            if ($band==1 && $c==0){ ?>
                <div class='cajita'></div>
            <?php
            }
       }
    ?>
    </div>

    <div style="float: left; width:13.3%; margin-left:0.9%">
        <?php
        for ($i=$inih; $i <= $finh ; $i++) { 
            $band=0;
            $c=0;
            $dat=$this->horarys;
            for ($s=0; $s < $len ; $s++) { 
                $hsplit=split(":", $dat[$s]['hora_ini']);
                $h=$hsplit[0];
                $m=$hsplit[1];
                $dia=$dat[$s]['day'];

                if ($dia==2) {
                    if ($this->horarys[$s]['hora_ini']!=$this->horarys[$s]['hora_fin']){
                            if ($hora[$i]['h_ini']==$h && $hora[$i]['m_ini']==$m) { 
                                    $this->horarys[$s]['hora_ini']= $hora[$i]['h_fin'].":".$hora[$i]['m_fin'].":00";
                                    ?>
                                    <div class="cajita" style="background-color:<?php echo $dat[$s]["color"] ?>"><?php echo $dat[$s]['abbreviation'].$dat[$s]['practica'] ?><span style="float:right; margin-right:1%"> (<?php echo $dat[$s]['turno']?>)</span></div>
                                    <?php    
                                    $c++;
                                } else { 
                                    $band=1;
                                }
                            }
                        } else { 
                            $band=1;
                        }
                    }
                    if($band==1 && $c==0){ ?>
                        <div class='cajita'></div>
                    <?php    
                    }
            }
            ?>
    </div>
    <div style="float: left; width:13.3%; margin-left:0.9%">
        <?php
        for ($i=$inih; $i <= $finh ; $i++) { 
            $band=0;
            $c=0;
            $dat=$this->horarys;
            for ($s=0; $s < $len ; $s++) { 
                $hsplit=split(":", $dat[$s]['hora_ini']);
                $h=$hsplit[0];
                $m=$hsplit[1];
                $dia=$dat[$s]['day'];

                if ($dia==3) {
                    if ($this->horarys[$s]['hora_ini']!=$this->horarys[$s]['hora_fin']){
                            if ($hora[$i]['h_ini']==$h && $hora[$i]['m_ini']==$m) { 
                                    $this->horarys[$s]['hora_ini']= $hora[$i]['h_fin'].":".$hora[$i]['m_fin'].":00";
                                    ?>
                                    <div class="cajita" style="background-color:<?php echo $dat[$s]["color"] ?>"><?php echo $dat[$s]['abbreviation'].$dat[$s]['practica'] ?><span style="float:right; margin-right:1%"> (<?php echo $dat[$s]['turno']?>)</span></div>
                                    <?php    
                                    $c++;
                                } else { 
                                    $band=1;
                                }
                            }
                        } else { 
                            $band=1;
                        }
                    }
                    if($band==1 && $c==0){ ?>
                        <div class='cajita'></div>
                    <?php    
                    }
            }
            ?>
    </div>
    <div style="float: left; width:13.3%; margin-left:0.9%">
        <?php
        for ($i=$inih; $i <= $finh ; $i++) { 
            $band=0;
            $c=0;
            $dat=$this->horarys;
            for ($s=0; $s < $len ; $s++) { 
                $hsplit=split(":", $dat[$s]['hora_ini']);
                $h=$hsplit[0];
                $m=$hsplit[1];
                $dia=$dat[$s]['day'];

                if ($dia==4) {
                    if ($this->horarys[$s]['hora_ini']!=$this->horarys[$s]['hora_fin']){
                            if ($hora[$i]['h_ini']==$h && $hora[$i]['m_ini']==$m) { 
                                    $this->horarys[$s]['hora_ini']= $hora[$i]['h_fin'].":".$hora[$i]['m_fin'].":00";
                                    ?>
                                    <div class="cajita" style="background-color:<?php echo $dat[$s]["color"] ?>"><?php echo $dat[$s]['abbreviation'].$dat[$s]['practica'] ?><span style="float:right; margin-right:1%"> (<?php echo $dat[$s]['turno']?>)</span></div>
                                    <?php    
                                    $c++;
                                } else { 
                                    $band=1;
                                }
                            }
                        } else { 
                            $band=1;
                        }
                    }
                    if($band==1 && $c==0){ ?>
                        <div class='cajita'></div>
                    <?php    
                    }
            }
            ?>
    </div>
    <div style="float: left; width:13.3%; margin-left:0.9%">
        <?php
        for ($i=$inih; $i <= $finh ; $i++) { 
            $band=0;
            $c=0;
            $dat=$this->horarys;
            for ($s=0; $s < $len ; $s++) { 
                $hsplit=split(":", $dat[$s]['hora_ini']);
                $h=$hsplit[0];
                $m=$hsplit[1];
                $dia=$dat[$s]['day'];

                if ($dia==5) {
                    if ($this->horarys[$s]['hora_ini']!=$this->horarys[$s]['hora_fin']){
                            if ($hora[$i]['h_ini']==$h && $hora[$i]['m_ini']==$m) { 
                                    $this->horarys[$s]['hora_ini']= $hora[$i]['h_fin'].":".$hora[$i]['m_fin'].":00";
                                    ?>
                                    <div class="cajita" style="background-color:<?php echo $dat[$s]["color"] ?>"><?php echo $dat[$s]['abbreviation'].$dat[$s]['practica'] ?><span style="float:right; margin-right:1%"> (<?php echo $dat[$s]['turno']?>)</span></div>
                                    <?php    
                                    $c++;
                                } else { 
                                    $band=1;
                                }
                            }
                        } else { 
                            $band=1;
                        }
                    }
                    if($band==1 && $c==0){ ?>
                        <div class='cajita'></div>
                    <?php    
                    }
            }
            ?>
    </div>
    <div style="float: left; width:13.3%; margin-left:0.9%">
        <?php
        for ($i=$inih; $i <= $finh ; $i++) { 
            $band=0;
            $c=0;
            $dat=$this->horarys;
            for ($s=0; $s < $len ; $s++) { 
                $hsplit=split(":", $dat[$s]['hora_ini']);
                $h=$hsplit[0];
                $m=$hsplit[1];
                $dia=$dat[$s]['day'];

                if ($dia==6) {
                    if ($this->horarys[$s]['hora_ini']!=$this->horarys[$s]['hora_fin']){
                            if ($hora[$i]['h_ini']==$h && $hora[$i]['m_ini']==$m) { 
                                    $this->horarys[$s]['hora_ini']= $hora[$i]['h_fin'].":".$hora[$i]['m_fin'].":00";
                                    ?>
                                    <div class="cajita" style="background-color:<?php echo $dat[$s]["color"] ?>"><?php echo $dat[$s]['abbreviation'].$dat[$s]['practica'] ?><span style="float:right; margin-right:1%"> (<?php echo $dat[$s]['turno']?>)</span></div>
                                    <?php    
                                    $c++;
                                } else { 
                                    $band=1;
                                }
                            }
                        } else { 
                            $band=1;
                        }
                    }
                    if($band==1 && $c==0){ ?>
                        <div class='cajita'></div>
                    <?php    
                    }
            }
            ?>

    </div>
    <div style="width:100%; margin-top:3%">
        <div class='cajacursos' style='width:3%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>#</b></div>
        <div class='cajacursos' style='width:5%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>Código</b></div>
        <div class='cajacursos' style='width:37%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>Nombre Curso</b></div>
        <div class='cajacursos' style='width:4%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>Cred.</b></div>
        <div class='cajacursos' style='width:4%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>Turno</b></div>
        <div class='cajacursos' style='width:30%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>Docente</b></div>
        <div class='cajacursos' style='width:3%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>HT</b></div>
        <div class='cajacursos' style='width:3%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>HP</b></div>
        <div class='cajacursos' style='width:3%;box-shadow: 0px 0px 4px #343434; margin-left: 8px;'><b>TT</b></div>

        <?php
        $n=0;
        $c=0;
        $p=0;
        $temc=$this->dcurso[0]['courseid'];
        $temt=$this->dcurso[0]['turno'];
        foreach ($this->dcurso as $dcurso)  { 
            $n++;
            if($dcurso['courseid']!=""){
                    if($dcurso['is_main']=='S' && $dcurso['state']=='A') $dcurso['pract']="";
                    else $dcurso['pract']=" (Practica)";                    
                    ?>
                            <div class="cajacursos" style="width:3%; margin-left:8px"><?php echo $n ?></div>
                            <?php
                                if($dcurso['courseid']==$temc && $dcurso['turno']==$temt){ 
                                    ?>
                                    <div class="cajacursos" style="width:5%; margin-left:8px;background-color:
                                    <?php echo $listacolores[$p];?>"><?php echo $dcurso['courseid'] ?>
                                    </div>                                    
                                    <?php
                                    $temc=$dcurso['courseid'];
                                    $temt=$dcurso['turno'];
                                }
                                else{
                                    $p++; 
                                    ?>
                                    <div class="cajacursos" style="width:5%; margin-left:8px;background-color:
                                    <?php echo $listacolores[$p];?>"><?php echo $dcurso['courseid'] ?>
                                    </div>                                    
                                    <?php
                                    $temc=$dcurso['courseid'];
                                    $temt=$dcurso['turno'];
                                } ?>
                            <div class="cajacursos" style="width:37%; margin-left:8px"><?php echo $dcurso['name'].$dcurso['pract']; ?></div>
                            <div class="cajacursos" style="width:4%; margin-left:8px"><?php echo $horaoriginal[$c]['credits'];?></div>
                            <div class="cajacursos" style="width:4%; margin-left:8px"><?php echo $dcurso['turno'] ?></div>
                            <div class="cajacursos" style="width:30%; margin-left:8px"><?php echo $this->dcurso[$c]['namet']?></div>
                            <div class="cajacursos" style="width:3%; margin-left:8px"><?php echo $dcurso['hours_t'] ?></div>
                            <div class="cajacursos" style="width:3%; margin-left:8px"><?php echo $dcurso['hours_p'] ?></div>
                            <div class="cajacursos" style="width:3%; margin-left:8px"><?php echo $dcurso['hours_total'] ?></div>
    </div>
                    <?php  
                    $c++;
            } 
        }        
        ?>
</div>
<?php
}
else{
?>
<div class="alert alert-info">No hay registro.</div>    
<?php
}
?>
<?php 
    
    $html = ob_get_contents();
  
    $mpdf=new mPDF('win-1252','A4-L','','',5,5,45,18,5,5);
    $mpdf->SetHTMLHeader($this->header);  
    $mpdf->SetHTMLFooter($this->footer);
    ob_end_clean();
    $mpdf -> WriteHTML($html);
    $mpdf->Output('Horario-'.$this->semid.'.pdf','D');
    // $mpdf->Output();  
?>