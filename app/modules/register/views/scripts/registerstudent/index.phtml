<?php $this->placeholder('Textnav')->append('<span class="glyphicon glyphicon-ok"></span> Validación de Matricula - '. 'Periodo '. $this->perid);?>
<?php $this->placeholder('Btnnav')->append('<a href="/rfacultad" class="btn btn-default"><span class="glyphicon glyphicon-arrow-left "></span> Regresar </a>');?>

<div class="row">
    <div class="col-md-5 col-md-offset-1">
        <span class="text-muted"><span class="glyphicon glyphicon-filter"></span> Filtre por :</span>
    </div>
</div>
<br>
<div class="row">
    <div class="col-md-3 col-md-offset-1">
        <select class='form-control' id='escuela' name='escid'>
            <option value="">Escuela</option>
            <?php foreach ($this->escuelas as $escuela){   
                echo "<option value=".$escuela['escid'].">".$escuela['name']."</option>";
            }?>
        </select>
    </div>
    <div class="col-md-5">
        <input id="searchData" type="text" class="form-control" title="Código" onkeyup="javascript:this.value=this.value.toUpperCase();" placeholder="Código o Apellidos">
    </div>
    <div class="col-md-2">
        <select  class='form-control' id="estado" name="estadom">
            <option value="<?php echo 'I'; ?>"><?php echo "Iniciado"; ?></option>
            <option value="<?php echo 'M'; ?>"><?php echo "Matriculado"; ?></option>
            <option value="<?php echo 'O'; ?>"><?php echo "Observado"; ?></option>
            <option value="<?php echo 'R'; ?>"><?php echo "Reservado"; ?></option>
        </select>
    </div>
</div>
<hr>
<div id="data"></div>

<div id="emptyData" class="hidden">
    <br>
    <h4 class="text-muted text-center">No existen <span class="text-danger">Registros</span></h4>
</div>

<script>
    var state = $('#estado').val();
    $('#data').html("<br><center><img src='/img/spinner.gif'> Cargando.... </center>");
    $("#data").load("/register/registerstudent/liststudent/state/"+state, function(){
        var num = 1;
        var i   = 1;
        $("#students li").each(function(){
            var cssli = $(this).css('display');
            if (cssli != 'none') {
                $('#studentNum'+[i]).html(num);
                num++;
            };
            i++;
        })
    });

    $('#estado').change(function(){
        $('#searchData').val('');
        var state = $(this).val();
        $('#data').html("<br><center><img src='/img/spinner.gif'> Cargando.... </center>");
        $('#data').load('/register/registerstudent/liststudent/state/' + state ,function(){
            var escid = $('#escuela').val();
            $('#students > li').each(function(){
                var currentLiText = $(this).text(),
                showCurrentLi = currentLiText.indexOf(escid) !== -1;

                $(this).toggle(showCurrentLi);
            });
            var num   = 1;
            var i     = 1;
            var vacio = 0;
            $("#students li").each(function(){
                var cssLiOrder = $(this).css('display');
                if (cssLiOrder != 'none') {
                    $('#studentNum'+[i]).html(num);
                    num++;
                }else{
                    vacio++;
                }
                i++;
            })
            $('#data').removeClass('hidden');
            $('#emptyData').addClass('hidden');
            var tam = $('#students li').size();
            if (tam == 0) {
                //$('#emptyData').removeClass('hidden');
            }else if (tam == vacio){
                $('#emptyData').removeClass('hidden');
                $('#data').addClass('hidden');
            }
        });
    });

    $('#escuela').change(function(){
        var escid = $(this).val();
        $('#students > li').each(function(){
            var currentLiText = $(this).text(),
            showCurrentLi = currentLiText.indexOf(escid) !== -1;
            $(this).toggle(showCurrentLi);

        });
        var num   = 1;
        var i     = 1;
        var vacio = 0;
        $("#students li").each(function(){
            cssLiOrder = $(this).css('display');
            if (cssLiOrder != 'none') {
                $('#studentNum'+[i]).html(num);
                num++;
            }else {
                vacio++;
            }
            i++;
        });
        $('#data').removeClass('hidden');
        $('#emptyData').addClass('hidden');
        var tam = $('#students li').size();
        if (tam == 0) {
            //$('#emptyData').removeClass('hidden');
        }else if (tam == vacio){
            $('#emptyData').removeClass('hidden');
            $('#data').addClass('hidden');
        }

        $('#searchData').val('');

        $('#students > li').each(function(){
            $(this).removeAttr('filtrado escid');
        });
    });

    $('#searchData').keyup(function(){
        var data = $(this).val();
        var reordenar = 'No';
        $('#students li').each(function(){
            $(this).attr('filtrado', 'Si');
            var escid = $('#escuela').val();
            var cssli = $(this).css('display');
            var currentLiText = $(this).text();
            if (escid && !data) {
                showCurrentLi = currentLiText.indexOf(escid) !== -1;
                $(this).toggle(showCurrentLi);
                $(this).removeAttr('filtrado');
                reordenar = 'Si';
            }else if (escid && data) {
                if (cssli != 'none') {
                    $(this).attr('escid', escid);
                    showCurrentLi = currentLiText.indexOf(data) !== -1;
                    $(this).toggle(showCurrentLi);
                }
                var claseLi = $(this).attr('escid');
                if (cssli == 'none' && claseLi == escid) {
                    showCurrentLi = currentLiText.indexOf(data) !== -1;
                    $(this).toggle(showCurrentLi);
                }
            }else if (!escid && data){
                showCurrentLi = currentLiText.indexOf(data) !== -1;
                $(this).toggle(showCurrentLi);
            }else if (!escid && !data){
                showCurrentLi = currentLiText.indexOf(data) !== -1;
                $(this).toggle(showCurrentLi);
                $(this).removeAttr('filtrado');
                reordenar = 'Si';
            }
        });
        if (reordenar == 'Si') {
            var num   = 1;
            var i     = 1;
            var vacio = 0;
            $("#students li").each(function(){
                var cssli = $(this).css('display');
                if (cssli != 'none') {
                    $('#studentNum'+[i]).html(num);
                    num++;
                }else {
                    vacio++;
                }
            })
            $('#data').removeClass('hidden');
            $('#emptyData').addClass('hidden');
            var tam = $('#students li').size();
            if (tam == 0) {
                //$('#emptyData').removeClass('hidden');
            }else if (tam == vacio){
                $('#emptyData').removeClass('hidden');
                $('#data').addClass('hidden');
            }
            
            reordenar == 'No';
        }
    })

</script>
