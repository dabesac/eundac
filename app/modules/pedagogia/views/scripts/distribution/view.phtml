
    <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>-->

<?php if ($this->dis): ?>
	<div class="row">
		<div class="col-md-2 col-md-offset-1">
			<h5 class="text-muted">
				<strong>Leyenda</strong>
			</h5>
		</div>
		<div class="col-md-2">
			<h5 class="text-muted">
				<img src="/img/circulo-verde.png"><span class="text-success"> Activo</span>
			</h5>
		</div>
		<div class="col-md-2">
			<h5 class="text-muted">
				<img src="/img/circulo-rojo.png"><span class="text-danger"> Cerrado/Inactivo</span>
			</h5>
		</div>
		<div class="col-md-2">
			<h5 class="text-muted">
				<img src="/img/circulo-amarillo.png"><span class="text-warning"> Observado</span>
			</h5>
		</div>
		<div class="col-md-2">
			<h5 class="text-muted">
				<img src="/img/circulo-azul.png"><span class="text-info"> Borrador</span>
			</h5>
		</div>
	</div>
	<hr>
	<table class="table table-hover" style="font-size:14px">
	<thead>
		<tr>
			<th class="text-center">#</th>
			<th class="text-center">Nombre de la Escuela</th>
			<th class="text-center">Fecha de Registro</th>
			<th class="text-center">Ver</th>
			<th class="text-center">Estado</th>
			<th class="text-center">Observación</th>
			<th class="text-center">Impresión</th>
			<th class="text-center">Cerrar Distribución</th>
		</tr>

	</thead>

	<tbody>
		<?php
		$i=0;
		// print_r($this->dis);exit();
		foreach ($this->dis as $distrib) {
			switch ($distrib['state']) {
				case 'A': 	$state = "<img src='/img/circulo-verde.png'>"; 
							$namestate = "Activo";
							break;
				case 'I': 	$state = "<img src='/img/circulo-rojo.png'>"; 
							$namestate = "Inactivo";
							break;
				case 'C': 	$state = "<img src='/img/circulo-rojo.png'>"; 
							$namestate = "Cerrado";
							break;
				case 'O': 	$state = "<img src='/img/circulo-amarillo.png'>"; 
							$namestate = "Observado";
							break;
				case 'B': 	$state = "<img src='/img/circulo-azul.png'>"; 
							$namestate = "Borrador";
							break;
			}
			$valor=$this->valor;
			if ($distrib['state']!="B" && $valor<>1) {
				$i++;
			?>
			<tr>
				<td class="text-center"><?php echo $i?></td>
				<td><?php echo $distrib['name']?></td>
				<!-- <td  class="text-center"><?php echo $distrib['number']?></td> -->
				<td class="text-center" style="width:6%"><?php echo substr($distrib['created'],0,10)?></td>
				<td  class="text-center">
					<h4><a id="seeDistribution<?php echo $distrib['number']?>" href="#" onclick="javascript: window.open('/distribution/printdistribution/index/perid/<?php echo base64_encode($distrib['perid'])?>/distid/<?php echo base64_encode($distrib['distid'])?>/escid/<?php echo base64_encode($distrib['escid'])?>/subid/<?php echo base64_encode($distrib['subid'])?>/t/U','Ver distribución','resizable=no,location=no,menubar=no,scrollbars=yes,status=no,toolbar=no,fullscreen=yes,dependent=no,width=850,height=750')"><span class="glyphicon glyphicon-eye-open" data-toggle="tooltip" title="Ver"></span>
	                </a></h4>	
				</td>
				<!-- <td> -->
				<?php 
				if ($distrib['comments']<>"" && $distrib['state']=="A"){	
					?>
				<td class="text-center">
					<p class="correction" comentss="<?php echo $distrib["comments"]?>">
						<span class='correc' title="AVISO" data-container="body" data-toggle="popover" data-content="Ya corrigió su distribución"><?php echo $state?></span>
					</p>
				</td>	
				<?php	
				}
				else{	?>
				<td class='text-center'>
					<span class='span' data-toggle="tooltip" title="<?php echo $namestate?>"><?php echo $state?></span>
				</td>	
				<?php	
				}
				if ($distrib['state']=="C") {	?>
					<td class="text-center text-danger"><h5><span title="Desactivado" rel="tooltip" class="glyphicon glyphicon-ban-circle"></span></h5>
				<?php
				}
				else{	?>
					<td><span title="eescriba" rel="tooltip" placeholder="escribaa" id="<?php echo $i?>"  value='editar'>
					<?php if($distrib['observation']=='')
					{
					  echo "Haga doble clic para editar su observación";
					}
					else
					{
					  echo trim($distrib['observation']);	
					}

					?></span></td>
				<?php
				}
				?>					


				<td class="text-center"><h4><a href='/distribution/printdistribution/index/perid/<?php echo base64_encode($distrib['perid'])?>/distid/<?php echo base64_encode($distrib['distid'])?>/escid/<?php echo base64_encode($distrib['escid'])?>/subid/<?php echo base64_encode($distrib['subid'])?>' data-dismiss="modal" aria-hidden="true" style="float:center"><span class="glyphicon glyphicon-print"></span></a></h4></td>
				<!--  Nombre: <span class="editText">Fulanito de tal</span> -->
				<!-- <td class="closedis text-center"> <a title='Eliminar un registro' href="#"><span class="glyphicon glyphicon-pencil"></span></a></td> -->
				<td class="text-center">
					<?php if ($distrib['state']!="C") {	?>
					<h4><a class="closedis" href="#" distid='<?php echo base64_encode($distrib['distid'])?>' perid='<?php echo base64_encode($distrib['perid'])?>' escid='<?php echo base64_encode($distrib['escid']);?>' subid='<?php echo base64_encode($distrib['subid'])?>'><span class="glyphicon glyphicon-lock" data-toggle="tooltip" title="Cerrar Distribución"></span></a></h4>
					<?php
					}
					else{	?>
						<h4><a href="#"><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Desactivada"></span></a></h4>
					<?php
					}
					?>
				</td>
			</tr>

			
			<script> 
            // $(function(){
            	$('#seeDistribution<?php echo $distrib['number']?>').hover(function(){
					$('#seeDistribution<?php echo $distrib['number']?>').tooltip('toggle');
				});

                $('#<?php echo $i?>').dblclick( function(){
                    var text = $(this).text();

					text=text.trim();
                    //alert(text);

                    $(this).empty().html('<input type="text" class="form-control" value="'+text+'">').find('input').focus();
                	}).keypress( function(e){
                    if(e.keyCode == 13){
                        var text = $('input', this).val();
                        $(this).html( text );

                    //alert("Campo actualizado");

                    //e.preventDefault();                 
                    //alert(url);
                    	$("#destino").load("/pedagogia/distribution/distribution/", {escid: "<?php echo $distrib['escid']?>", distid: "<?php echo $distrib['distid']?>",perid: "<?php echo $distrib['perid']?>",subid: "<?php echo $distrib['subid']?>",observation: text}, function(){
                		});
                		$('.correc').popover('hide');

                    };
                });
            // });
        	</script>

			<?php
			}
			elseif($distrib['state']=="B" && $valor==1){
				$i++;
			?>
			<tr>
				<td class="text-center"><?php echo $i?></td>
				<td><?php echo $distrib['name']?></td>
				<td class="text-center"><?php echo substr($distrib['created'],0,10)?></td>
				<td class="text-center">
					<h4><a id="seeDistribution<?php echo $distrib['number']?>" href="#" onclick="javascript: window.open('/distribution/printdistribution/index/perid/<?php echo base64_encode($distrib['perid'])?>/distid/<?php echo base64_encode($distrib['distid'])?>/escid/<?php echo base64_encode($distrib['escid'])?>/subid/<?php echo base64_encode($distrib['subid'])?>/t/U','Eliminar Cursos','resizable=no,location=no,menubar=no,scrollbars=yes,status=no,toolbar=no,fullscreen=yes,dependent=no,width=850,height=750')"><span class="glyphicon glyphicon-eye-open" data-toggle="tooltip" title="Ver"></span>
	                </a></h4>	
				</td>
				<td class="text-center">
					<span class='span' data-toggle="tooltip" title="<?php echo $namestate?>"><?php echo $state?></span>
				</td>
					
				<td class="text-center text-danger"><h5><span title="Desactivado" rel="tooltip" class="glyphicon glyphicon-ban-circle"></span></h5>
				</td>				
				<td class="text-center"><h4><a href='/distribution/printdistribution/index/perid/<?php echo base64_encode($distrib['perid'])?>/distid/<?php echo base64_encode($distrib['distid'])?>/escid/<?php echo base64_encode($distrib['escid'])?>/subid/<?php echo base64_encode($distrib['subid'])?>' data-dismiss="modal" aria-hidden="true" style="float:center"><span class="glyphicon glyphicon-print"></span></h4></td>
				<td class="text-center text-danger"><h5><span title="Desactivado" rel="tooltip" class="glyphicon glyphicon-ban-circle"></span></h5>
				</td>
			</tr>
			<?php	
			}			
		}
		?>
	</tbody>
	</table>
<?php else: ?>
	<div class='col-md-10 col-md-offset-1 cont-font-not-register alert alert-info'>
		<h3 class="text-info text-center"><b>No existen datos de esta escuela en este periodo...</b></h3>	    
	    <h1 class='span-not-register'>
	        <span class='glyphicon glyphicon-exclamation-sign' ></span>
	    </h1>
	</div>
<?php endif ?>

<div id="cargaqui"></div>
<!-- Modal -->
<div class="modal fade" id="myModal">
  <div class="modal-dialog" style="width:30%">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">ESTA SEGURO DE CERRAR LA DISTRIBUCIÓN?</h4>
      </div>
      <div class="modal-body">
        	<button id="aceptars" type="button" class="btn btn-success">Aceptar</button>
        	<button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<!-- Corregir distribución-->
<div class="modal fade" id="myModals" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  	<div class="modal-dialog">
    	<div class="modal-content">
      		<div class="modal-header">
        		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        		<h3 class="modal-title text-danger text-center" id="myModalLabel"><b>Comentario de la distribución</b></h3>
      		</div>
      		<div class="modal-body">
      			<div id="comments"></div>
      		</div>
      		<div class="modal-footer">
        		<button type="button" class="btn btn-danger" data-dismiss="modal" >Cerrar</button>
      		</div>
    	</div><!-- /.modal-content -->
  	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>
	$(".correction").hover(function(){
		var comentss=$(this).attr('comentss');
		var sms="<h4><b class='text-info'>Comentario de parte del director de la respectiva escuela: </b><br><br>"+comentss+"<hr></h4>";
		$('#comments').html(sms);
		$("#myModals").modal("show");
	});

	// $("#cargaqui").hide();
	$(".glyphicon").tooltip();
	$(".span").tooltip();

	$(function () {
		$('.correc').popover('show');
	});
	setTimeout(function() {
	  $('.correc').popover('hide');
	}, 10000);

	$("#faculty").change(function(){
		$('.correc').popover('hide');
		$("#data").hide();
	});
	$("#periods").change(function(){
		$('.correc').popover('hide');
		$("#data").hide();
	});
	$("#anios").change(function(){
		$('.correc').popover('hide');
		$("#data").hide();
	});

	$(".closedis").click(function(){
		$("#myModal").modal("show");
		var params = {
			escid:$(this).attr('escid'),
			subid:$(this).attr('subid'),
			distid:$(this).attr('distid'),
			perid:$(this).attr('perid')
		};
		$("#aceptars").click(function(){
			$("#myModal").modal("hide");
			$('#myModal').on('hidden.bs.modal', function (e) {
				var perid = $('#periods').val();
				var facid = $('#faculty').val();
				var url1=("/pedagogia/distribution/closedistribution/state/<?php echo base64_encode("C")?>/escid/"+params['escid']+"/subid/"+params['subid']+"/distid/"+params['distid']+"/perid/"+params['perid']);
				// alert(url1);
				$("#cargaqui").load(url1);
				// $('#data').html('<center><img class="text-center" src="/img/spinner.gif"></center>');
				var url2=("/pedagogia/distribution/view/perid/"+perid+"/facid/"+facid);
				$('#data').load(url2);
				$('.correc').popover('hide');
			})
		});
	});
</script>
 <div id="destino"></div> 
