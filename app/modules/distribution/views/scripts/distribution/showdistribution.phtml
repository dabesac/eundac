<?php
$ldistri =$this->ldistribution;
?>
<?php if ($this->ldistribution): ?>


<div class="row">
	<div class="col-md-2 col-md-offset-1">
		<h5 class="text-muted">
			<strong>Leyenda</strong>
		</h5>
	</div>
	<div class="col-md-2">
		<h5 class="text-muted">
			<img src="/img/circulo-verde.png"><span class="text-success"> Activo</span>
		</h5>
	</div>
	<div class="col-md-2">
		<h5 class="text-muted">
			<img src="/img/circulo-rojo.png"><span class="text-danger"> Cerrado/Inactivo</span>
		</h5>
	</div>
	<div class="col-md-2">
		<h5 class="text-muted">
			<img src="/img/circulo-amarillo.png"><span class="text-warning"> Observado</span>
		</h5>
	</div>
	<div class="col-md-2">
		<h5 class="text-muted">
			<img src="/img/circulo-azul.png"><span class="text-info"> Borrador</span>
		</h5>
	</div>
</div>
<hr>

<div class="table-responsive">
<table class="table table-hover table-condensed"> 
	<tr>
		<th class="col-md-1 text-center">#</th>
		<th class="col-md-1 text-center">Periodo</th>
		<th >Número</th>
		<th class="col-md-2 text-center">Fecha Aprobación</th>
		<th class="col-md-1 text-center">Estado</th>
		<th class="col-md-2"><center>Modificar Horario</center></th>
		<th class="col-md-3" colspan="5"><center>Operaciones</center></th>
	</tr>
	<?php 
	if ($ldistri)
	{			
		$i=0;
		foreach ($ldistri as $distri)
		{
		$hours = $distri['hours'];	
		$periodo = $distri['perid'];
		$num = $distri['number'];
		$approv = $distri['dateaccept'];
		$distid = base64_encode($distri['distid']);
		$perid = base64_encode($distri['perid']);
		$per = $distri['perid'];
		$state="";
		$image="";
		$state = ($distri['state']=='A')?"class='success'":"";
		$i++; 
		switch ($distri['state']) {
			case 'A': 	$state = "success"; 
						$namestate = "Activo";
						$img="verde";
						break;
			case 'I': 	$state = "danger"; 
						$namestate = "Inactivo";
						$img="rojo";
						break;
			case 'C': 	$state = "danger"; 
						$namestate = "Cerrado";
						$img="rojo";
						break;
			case 'B': 	$state = "info"; 
						$namestate = "Borrador";
						$img="azul";
						break;
			case 'O': 	$state = "warning"; 
						$namestate = "Observado";
						$img="amarillo";
						break;
		}
	?>
	<tr class="<?php echo $state?>">
		<td class="text-center"><?php echo $i;?></td>	
		<td class="text-center"><?php echo $periodo ;?></td>
		<td><?php echo $num;?></td>
		<td class="text-center"><?php echo $approv;?></td>
		<td class="text-center <?php echo $state?>">
			<?php
			if ($distri['observation']!='' && $distri['observation']!="''" && $distri['state']=='O') {	?>
				<img class="obser1" src="/img/circulo-<?php echo $img?>.png"><span class='obser text-<?php echo $state?>' title="Observado" data-container="body" data-toggle="popover" data-content="DISTRIBUCIÓN OBSERVADA POR PEDAGOGÍA" observation='<?php echo $distri['observation']?>' distid='<?php echo $distid;?>' perid='<?php echo $perid;?>' escid='<?php echo base64_encode($distri['escid']);?>' subid='<?php echo base64_encode($distri['subid'])?>'>
				</span>
			<?php	
			}
			else{
			?>
				<img src="/img/circulo-<?php echo $img?>.png"><span title="<?php echo $namestate?>" data-toggle="popover" class="text-<?php echo $state?>"></span>
			<?php	
			}
			?>
		</td>
		<td><center>
			<?php
			if ($distri['state']=='C' || $distri['state']=='I') { ?>
				<a href="#" ><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Modificación Inactiva"></span></a>
				<?php
			}elseif ($distri['state']=="A" || $distri['state']=="B" || $distri['state']=='O') {
				if ($hours) {
				?>
					<a href='#'class='updatehour' data-toggle="modal" data-target="#myModal" perid='<?php echo $per;?>' escid='<?php echo $distri['escid'];?>' subid='<?php echo $distri['subid']?>'><span class="glyphicon glyphicon-pencil" data-toggle="tooltip" title="Modifique Horario"></span></a>

				<?php
				}
				else{
				?>	
					<a href="#"><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Modificación Inactiva"></span></a>
				<?php						
				}
			}?>
			</center>
		</td>
		<td><center>
			<?php
			if ($distri['state']=='C' || $distri['state']=='I') { ?>
				<a href="#"><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Distribución Cerrado"></span></a>
				<?php
			}elseif ($distri['state']=="B") {
				?>				
					<a id="sendp" href="#" distid='<?php echo $distid;?>' perid='<?php echo $perid;?>' escid='<?php echo base64_encode($distri['escid']);?>' subid='<?php echo base64_encode($distri['subid'])?>'><span class="glyphicon glyphicon-send" data-toggle="tooltip" title="Enviar Distribución a pedagogía"></span></a>
				<?php						
			}
			else{	?>
				<a href="#"><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Enviar Distribución a pedagogía Desactivada"></span></a>
			<?php	
			}
			?>
			</center>
		</td>
		<td>
			<center>
				<a href="/distribution/printdistribution/index/escid/<?php echo base64_encode($distri['escid'])?>/subid/<?php echo base64_encode($distri['subid'])?>/perid/<?php echo $perid;?>/distid/<?php echo $distid;?>"><span class="glyphicon glyphicon-print" data-toggle="tooltip" title="Imprimir Distribución"></span></a>
			</center>
		</td>
		<td>
			<center>
				<a href="/distribution/distribution/edit/distid/<?php echo $distid;?>/perid/<?php echo $perid;?>/anio/<?php echo base64_encode($this->anio) ?>"><span class="glyphicon glyphicon-edit" data-toggle="tooltip" title="Modificar Distribución"></span></a>
			</center>
		</td>
		<td>
			<center>
				<a href="/distribution/distribution/delete/distid/<?php echo $distid;?>/perid/<?php echo $perid;?>"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" title="Eliminar Distribución"></span></a>
			</center>
		</td>
		<td><center>
			<?php
			if ($distri['state']=='C' || $distri['state']=='I') { ?>
				<a href="#"><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Distribución Cerrado"></span></a>
				<?php
			}elseif ($distri['state']=="A" || $distri['state']=="B" || $distri['state']=='O') {
				if ($hours) {
				?>
					<a href="/distribution/distribution/academicload/distid/<?php echo $distid;?>/perid/<?php echo $perid;?>/escid/<?php echo base64_encode($distri['escid'])?>/subid/<?php echo base64_encode($distri['subid'])?>"><span class="glyphicon glyphicon-arrow-right" data-toggle="tooltip" title="Carga Académica Distribución"></span></a>
				<?php
				}
				else{
				?>	
					<a href='#' class='horary' data-toggle="modal" data-target="#myModal1" distid='<?php echo $distid;?>' perid='<?php echo $perid;?>' escid='<?php echo base64_encode($distri['escid']);?>' subid='<?php echo base64_encode($distri['subid'])?>'><span class="glyphicon glyphicon-calendar" data-toggle="tooltip" title="Ingrese Horario de Clases"></span></a>
				<?php						
				}
			}?>
			</center>
		</td>
	</tr>		
	<?php }
	}
	?>
</table>
</div>

<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body">
        <div id='hourbegin'></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" >Cerrar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-- Modal Modificar-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body">
        <div id='updatehour'></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" >Cerrar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Corregir distribución-->
<div class="modal fade" id="myModals" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 class="modal-title text-danger text-center" id="myModalLabel"><b>Revise su distribución</b></h3>
      </div>
      <div class="modal-body">
        <div class="alert alert-info" style="width:90%; margin-left:5%"><h4><b>Sí corrigío la distribución click aquí <button id="sendis" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-send"></span></button></b> para que pedagogía lo revise</h4></div>
      	<div id="obs"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" >Cerrar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div id="valids"></div>

<script>
// $("#valids").hide();
$('.obser1').hover(function(){   
	$('#myModals').modal('show');	
	var params = {
		observation:$(this).attr('observation'),
		escid1:$(this).attr('escid'),
		subid1:$(this).attr('subid'),
		distid1:$(this).attr('distid'),
		perid1:$(this).attr('perid')
	};
	var sms="<h4><b>Este es la observación: </b>"+params['observation']+"</h4>";
	$('#obs').html(sms);
	$("#sendis").click(function(){
		$("#myModals").modal("hide");
		$('#myModals').on('hidden.bs.modal', function (e) {
			var url="/distribution/distribution/sendistribution/state/<?php echo base64_encode("A")?>/escid/"+params['escid1']+"/subid/"+params['subid1']+"/distid/"+params['distid1']+"/perid/"+params['perid1']+"/comment/<?php echo base64_encode("S")?>/";
			$("#valids").load(url);
			$('.obser').popover('hide');
		})
	});
});

$("#sendis").click(function(){
	$("#myModals").modal("hide");
});

$("#sendp").click(function(){
	var params = {
		escid1:$(this).attr('escid'),
		subid1:$(this).attr('subid'),
		distid1:$(this).attr('distid'),
		perid1:$(this).attr('perid')
	};
	var url="/distribution/distribution/sendistribution/state/<?php echo base64_encode("A")?>/escid/"+params['escid1']+"/subid/"+params['subid1']+"/distid/"+params['distid1']+"/perid/"+params['perid1'];
		$("#valids").load(url);
});
$('.glyphicon').tooltip();

$(function () {
	$('.obser').popover('show');
});	

setTimeout(function() {
  	$('.obser').popover('hide');
}, 15000);

$(".horary").click(function(){
	var params = {
		escid:$(this).attr('escid'),
		subid:$(this).attr('subid'),
		distid:$(this).attr('distid'),
		perid:$(this).attr('perid')
	};
	$.get("/horary/nhorary/changehours/",
		params,
		function  ($data) {
			$("#hourbegin").html('<br><center>Cargando <img src="/img/spinner.gif" alt="Cargando ..." /></center>');
			$("#hourbegin").html($data);
	});

});

$(".updatehour").click(function(){
	var para = {
		escid:$(this).attr('escid'),
		subid:$(this).attr('subid'),
		perid:$(this).attr('perid')
	};
	$.get("/horary/nhorary/updatehours/",
		para,
		function  ($data) {
			$("#updatehour").html('<br><center>Cargando <img src="/img/spinner.gif" alt="Cargando ..." /></center>');
			$("#updatehour").html($data);
	});
});
</script>

<?php else: ?>
	<div class='col-md-12 cont-font-not-register'>
        <h1 class='span-not-register'>
            <span class='glyphicon glyphicon-exclamation-sign'></span>
        </h1>
        <h3 class='text-not-register'>No existen <span class="text-danger">registros</h3>
    </div>
<?php endif ?>