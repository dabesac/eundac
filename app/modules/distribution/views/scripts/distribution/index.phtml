<?php
$ldistri =$this->ldistribution;
?>
<div class="panel panel-primary">
	<div class="pull-left"><h4>DISTRIBUCIONES</h4></div>
	<div class="pull-right"><a href="/distribution/distribution/new" class="btn btn-info"><span class="glyphicon glyphicon-pencil"></span> NUEVO</a></div>
	<br><br>
</div>
<div class="row" style="margin-bottom: 10px">
  <div class="col-md-3"><center><img src="/img/circulo-verde.png"> Activo</center></div>
  <div class="col-md-3"><center><img src="/img/circulo-rojo.png"> Cerrado</center></div>
  <div class="col-md-3"><center><img src="/img/circulo-amarillo.png"> Borrador</center></div>
  <div class="col-md-3"><center><img src="/img/circulo-azul.png"> Observado</center></div>
</div>
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed"> 
	<tr>
		<th class="col-md-1">#</th>
		<th class="col-md-1">Periodo</th>
		<th >Número</th>
		<th class="col-md-2">Fecha Aprobación</th>
		<th class="col-md-1">Estado</th>
		<th class="col-md-1"><center>Modificar Horario</center></th>
		<th class="col-md-3" colspan="4"><center>Operaciones</center></th>
	</tr>
	<?php 
	if ($ldistri)
	{		
		$i=0;
		foreach ($ldistri as $distri)
		{
		$hours = $distri['hours'];	
		$periodo = $distri['perid'];
		$num = $distri['number'];
		$approv = $distri['dateaccept'];
		$distid = base64_encode($distri['distid']);
		$perid = base64_encode($distri['perid']);
		$state="";
		$image="";
		$state = ($distri['state']=='A')?"class='success'":"";
		$i++; 
		switch ($distri['state']) {
			case 'A': $image = "/img/circulo-verde.png"; break;
			case 'I': $image = "/img/circulo-rojo.png"; break;
			case 'C': $image = "/img/circulo-rojo.png"; break;
			case 'B': $image = "/img/circulo-amarillo.png"; break;
			case 'O': $image = "/img/circulo-azul.png"; break;
		}
	?>
	<tr <?php echo $state;?>>
		<td><?php echo $i;?></td>	
		<td><?php echo $periodo ;?></td>
		<td><?php echo $num;?></td>
		<td><?php echo $approv;?></td>
		<td><img src='<?php echo $image;?>'></td>
		<td><center>
			<?php
			if ($distri['state']=='C' || $distri['state']=='I') { ?>
				<a href="#"><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Modificación Inactiva"></span></a>
				<?php
			}elseif ($distri['state']=="A" || $distri['state']=="B" || $distri['state']=='O') {
				if ($hours) {
				?>
					<a class='updatehour' data-toggle="modal" data-target="#myModal" perid='<?php echo $perid;?>' escid='<?php echo base64_encode($distri['escid']);?>' subid='<?php echo base64_encode($distri['subid'])?>'><span class="glyphicon glyphicon-pencil" data-toggle="tooltip" title="Modifique Horario"></span></a>

				<?php
				}
				else{
				?>	
					<a href="#"><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Modificación Inactiva"></span></a>
				<?php						
				}
			}?>
			</center>
		</td>
		<td>
			<center>
				<a href="/distribution/printdistribution/index/escid/<?php echo base64_encode($distri['escid'])?>/subid/<?php echo base64_encode($distri['subid'])?>/perid/<?php echo $perid;?>/distid/<?php echo $distid;?>"><span class="glyphicon glyphicon-print" data-toggle="tooltip" title="Imprimir Distribución"></span></a>
			</center>
		</td>
		<td>
			<center>
				<a href="/distribution/distribution/edit/distid/<?php echo $distid;?>/perid/<?php echo $perid;?>"><span class="glyphicon glyphicon-edit" data-toggle="tooltip" title="Modificar Distribución"></span></a>
			</center>
		</td>
		<td>
			<center>
				<a href="/distribution/distribution/delete/distid/<?php echo $distid;?>/perid/<?php echo $perid;?>"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" title="Eliminar Distribución"></span></a>
			</center>
		</td>
		<td><center>
			<?php
			if ($distri['state']=='C' || $distri['state']=='I') { ?>
				<a href="#"><span class="glyphicon glyphicon-ban-circle" data-toggle="tooltip" title="Distribución Cerrado"></span></a>
				<?php
			}elseif ($distri['state']=="A" || $distri['state']=="B" || $distri['state']=='O') {
				if ($hours) {
				?>
					<a href="/distribution/distribution/academicload/distid/<?php echo $distid;?>/perid/<?php echo $perid;?>/escid/<?php echo base64_encode($distri['escid'])?>/subid/<?php echo base64_encode($distri['subid'])?>"><span class="glyphicon glyphicon-arrow-right" data-toggle="tooltip" title="Carga Académica Distribución"></span></a>
				<?php
				}
				else{
				?>	
					<a class='horary' data-toggle="modal" data-target="#myModal1" distid='<?php echo $distid;?>' perid='<?php echo $perid;?>' escid='<?php echo base64_encode($distri['escid']);?>' subid='<?php echo base64_encode($distri['subid'])?>'><span class="glyphicon glyphicon-calendar" data-toggle="tooltip" title="Ingrese Horario de Clases"></span></a>
				<?php						
				}
			}?>
			</center>
		</td>
	</tr>		
	<?php }
	}
	?>
</table>
</div>

<!-- Modal Nuevo-->
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body">
        <div id='hourbegin'></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" >Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-- Modal Modificar-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body">
        <div id='updatehour'></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" >Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>
$('.glyphicon').tooltip();

$(".horary").click(function(){
	var params = {
		escid:$(this).attr('escid'),
		subid:$(this).attr('subid'),
		distid:$(this).attr('distid'),
		perid:$(this).attr('perid')
	};
	$.get("/horary/nhorary/changehours/",
		params,
		function  ($data) {
			$("#hourbegin").html($data);
	});

});

$(".updatehour").click(function(){
	var para = {
		escid:$(this).attr('escid'),
		subid:$(this).attr('subid'),
		perid:$(this).attr('perid')
	};
	$.get("/horary/nhorary/updatehours/",
		para,
		function  ($data) {
			$("#updatehour").html($data);
	});
});
</script>