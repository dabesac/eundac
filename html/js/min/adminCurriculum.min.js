/* Minified by LiamKlyneker*/
$(function(){function a(){function a(a){$("#dataCurriculums").html(""),a?$("#selectSchool").html('<option value="">Cargando...</option>').load("/default/global/listschools/id/"+a):$("#selectSchool").html('<option value="">Escuela</option><option value="">Primero seleccione alguna facultad ¬¬</option>')}function b(a){a?$("#dataCurriculums").html('<br><br><center><img src="/img/spinner.gif" alt="Loading" /></center>').load("/curricula/curricula/listcurriculums/id/"+a,function(){n=$("#selectSpeciality").val(),d(n),e()}):$("#dataCurriculums").html("")}function d(a){$(".curriculums").each(function(){currentLiText=$(this).text(),showCurrentLi=-1!==currentLiText.indexOf(a),$(this).toggle(showCurrentLi),showCurrentLi&&(existData=0)}),"RC"==c&&$("html body").animate({scrollTop:$("#selectFaculty").offset().top})}function e(){$("#selectSpeciality").on("change",function(){n=$(this).val(),d(n),$("#dataFormNewCur").html('<br><br><br><center><img src="/img/spinner.gif" alt="Loading..." /></center>').load("/curricula/curricula/newcurricula/id/"+n,function(){j()})}),$("#dataFormNewCur").html('<br><br><br><center><img src="/img/spinner.gif" alt="Loading..." /></center>').load("/curricula/curricula/newcurricula/id/"+n,function(){j()});var a;$(".curriculum").each(function(b,c){a=$(c).attr("idactivatejs"),f(a)})}function f(a){var b=$("#curriculum"+a),c=$(b).find(".modify").children(".btnDetailCur"),d=$(b).find(".modify").children(".btn_derive"),e=$(b).find(".modify").children(".btn_delete"),f=$(b).attr("state");$(b).hasClass("showCurriculum")&&$(b).removeClass("showCurriculum"),$(c).on("click",function(){p=$(this).attr("ide"),q=$(this).attr("idjs"),$("#dataDetailCur").html('<br><br><br><center><img src="/img/spinner.gif" alt="Loading..." /></center>').load("/curricula/curricula/admincurriculum/state/"+f+"/id/"+p,function(){k(p,q)})});var h,j;$(d).on("click",function(){j=$(this);var a=$(j).siblings(".derive_from_draft");h=$(j).attr("goto"),p=$(j).attr("ide"),q=$(j).attr("idjs"),$(j).toggleClass("active_a");var b="";$(".derive_from_draft").each(function(a,c){b=$(c).attr("fromto"),h!=b&&$(c).hasClass("active_derive")&&($(c).siblings(".btn_derive").removeClass("active_a"),$(c).addClass("hide_derive"),setTimeout(function(){$(c).removeClass("active_derive hide_derive")},300))}),$(".delete_curriculum").each(function(a,b){$(b).hasClass("active_confirm")&&($(b).addClass("hide_confirm"),$(".btn_delete").removeClass("active_delete"),setTimeout(function(){$(b).removeClass("active_confirm hide_confirm"),$(b).parent().slideUp(150)},300))}),$(a).hasClass("active_derive")?($(a).addClass("hide_derive"),setTimeout(function(){$(a).removeClass("active_derive hide_derive")},300)):$(a).addClass("active_derive")}),$(e).on("click",function(){j=$(this),h=$(j).attr("goto"),p=$(j).attr("ide"),$(".btn_derive").removeClass("active_a active_active active_temporary active_close"),$(".derive_from_draft").each(function(a,b){$(b).hasClass("active_derive")&&($(b).addClass("hide_derive"),setTimeout(function(){$(b).removeClass("active_derive hide_derive")},300))})}),$("#curriculum"+a+" .derive_from_draft a, #curriculum"+a+" .btn_delete").on("click",function(){var a=$(this),b=$(a).parent(".derive_from_draft");$(b).addClass("hide_derive"),setTimeout(function(){$(b).removeClass("active_derive hide_derive")},300);var c=$(a).attr("type"),d="",e="";$(".confirm_side").each(function(a,b){e=$(b).parent().attr("fromto"),d=$(b).attr("type"),h!=e?$(b).hasClass("active_confirm")&&($(b).addClass("hide_confirm"),setTimeout(function(){$(b).removeClass("active_confirm hide_confirm"),$(b).parent().slideUp(150)},300)):c!=d&&$(b).hasClass("active_confirm")&&($(b).addClass("hide_confirm"),setTimeout(function(){$(b).removeClass("active_confirm hide_confirm")},300))}),$(".btn_delete").removeClass("active_delete"),$(".btn_derive").removeClass("active_a active_active active_temporary active_close");var f=c+"_curriculum",g="active_"+c,i=$("#curriculum_confirm"+h).find("."+f);$("#curriculum_confirm"+h).slideDown(150),$(i).addClass("active_confirm"),$(j).removeClass("active_a active_active active_temporary active_close").addClass(g)}),$("#curriculum_confirm"+a+" .confirm_side a:nth-child(3)").on("click",function(){g()}),$("#curriculum_confirm"+a+" .confirm_side a:nth-child(2)").on("click",function(){var a=$(this).attr("whycallme");$(this).html('<img src="/img/spinner.gif" alt="Loading..." />'),i(a,p,h)})}function g(){$(".btn_derive").removeClass("active_a active_active active_temporary active_close"),$(".btn_delete").removeClass("active_delete"),$(".confirms_side .confirm_side").each(function(a,b){$(b).hasClass("active_confirm")&&($(b).addClass("hide_confirm"),setTimeout(function(){$(b).removeClass("active_confirm hide_confirm"),$(b).parent().slideUp(150)},300))}),$(".derive_from_draft").each(function(a,b){$(b).hasClass("active_derive")&&($(b).siblings(".btn_derive").removeClass("active_a"),$(b).addClass("hide_derive"),setTimeout(function(){$(b).removeClass("active_derive hide_derive")},300))})}function h(a){var b=!0;$(a).children(".curriculum").each(function(a,c){$(c).children("span:nth-child(1)").html(a+1),b=!1}),$(a).hasClass("div_temporary")&&$(a).parent().hasClass("main_hide")&&($(a).parent().slideDown("fast"),$(a).parent().siblings(".for_message").slideUp("fast")),b?($(a).children(".empty_message").slideDown("fast"),$(a).hasClass("div_draft")&&setTimeout(function(){$(a).parent(".main").slideUp("fast"),$(a).children(".empty_message").slideUp("fast")},7e3)):($(a).siblings(".empty").slideUp("fast"),$(a).children(".empty_message").slideUp("fast"))}function i(a,b,c){$.ajax({url:"/curricula/curricula/icallyou",data:{id:b,why:a},dataType:"json",success:function(d){if(console.log(d),1===d.success){g();var e=new Object;if(e.name=$("#curriculum"+c+" span:nth-child(2)").html(),e.year=$("#curriculum"+c+" span:nth-child(3)").html(),"A"==a){var i=$("#curriculums"+n).find(".div_active"),j=$("#curriculum"+c).parent(),k=$(i).children(".curriculum");if($(k).attr("state")){var l=new Object;l.name=$(k).children("span:nth-child(2)").html(),l.year=$(k).children("span:nth-child(3)").html(),l.idJs=$(k).attr("idactivatejs"),l.idGet=$(k).attr("idget")}$("#curriculum"+c).addClass("removeCurriculum"),setTimeout(function(){$("#curriculum"+c+", #curriculum_confirm"+c).remove();var a='<div id="curriculum'+c+'" class="curriculum showCurriculum" idactivatejs="'+c+'" idget="'+b+'" state="A"><span><span class="glyphicon glyphicon-ok"></span></span><span>'+e.name+"</span><span>"+e.year+'</span><div class="modify active_modify"><a href="##">Ver Cursos</a><a href="##" ide="'+b+'" idjs="'+c+'" class="btnDetailCur" data-toggle="modal" data-target="#modalDetailCur" title="Mire los detalles de esta currícula...">Detalles</a></div></div>';$(i).html(a),f(c),a='<div id="curriculum'+l.idJs+'" class="curriculum showCurriculum" idactivatejs="'+l.idJs+'" state="T"><span><span class="glyphicon glyphicon-ok"></span></span><span>'+l.name+"</span><span>"+l.year+'</span><div class="modify temporary_modify"><a href="##">Administrar Cursos</a><a href="##" ide="'+l.idGet+'" idjs="'+l.idJs+'" class="btnDetailCur" data-toggle="modal" data-target="#modalDetailCur" title="Mire los detalles de esta currícula...">Detalles</a><a href="##" class="btn_derive" ide="'+l.idGet+'" goto="'+l.idJs+'">Derivar</a><div class="derive_from_draft" fromto="'+l.idJs+'"><a href="##" type="active">Activar Curricula</a><a href="##" type="close">Cerrar Curricula</a></div></div></div><div id="curriculum_confirm'+l.idJs+'" fromto="'+l.idJs+'" class="confirms_side"><div class="confirm_side delete_curriculum" type="delete"><p>Confírme si desea eliminar esta currícula...</p><a href="##" whycallme="D">Si, quiero eliminarla</a><a href="##">Cancelar</a></div><div class="confirm_side active_curriculum" type="active"><p>Confírme si desea activar esta currícula, si hay otra activa ésta la remplazara...</p><a href="##" whycallme="A">Si, quiero activarla</a><a href="##">Cancelar</a></div><div class="confirm_side temporary_curriculum" type="temporary"><p>Confírme si desea mover esta currícula a temporales...</p><a href="##" whycallme="T">Si, quiero moverla a temporales</a><a href="##">Cancelar</a></div><div class="confirm_side close_curriculum" type="close"><p>Confírme si desea cerrar esta currícula...</p><a href="##" whycallme="C">Si, quiero cerrarla</a><a href="##">Cancelar</a></div></div>';var d=$("#curriculums"+n).find(".div_temporary");$(d).prepend(a),f(l.idJs),h(j),h(d)},300)}else if("T"==a){var i=$("#curriculums"+n).find(".div_temporary"),j=$("#curriculum"+c).parent();$("#curriculum"+c).addClass("removeCurriculum"),setTimeout(function(){$("#curriculum"+c+", #curriculum_confirm"+c).remove();var a='<div id="curriculum'+c+'" class="curriculum showCurriculum" idactivatejs="'+c+'" state="T"><span><span class="glyphicon glyphicon-ok"></span></span><span>'+e.name+"</span><span>"+e.year+'</span><div class="modify temporary_modify"><a href="##">Administrar Cursos</a><a href="##" ide="'+b+'" idjs="'+c+'" class="btnDetailCur" data-toggle="modal" data-target="#modalDetailCur" title="Mire los detalles de esta currícula...">Detalles</a><a href="##" class="btn_derive" ide="'+b+'" goto="'+c+'">Derivar</a><div class="derive_from_draft" fromto="'+c+'"><a href="##" type="active">Activar Curricula</a><a href="##" type="close">Cerrar Curricula</a></div></div></div><div id="curriculum_confirm'+c+'" fromto="'+c+'" class="confirms_side"><div class="confirm_side delete_curriculum" type="delete"><p>Confírme si desea eliminar esta currícula...</p><a href="##" whycallme="D">Si, quiero eliminarla</a><a href="##">Cancelar</a></div><div class="confirm_side active_curriculum" type="active"><p>Confírme si desea activar esta currícula, si hay otra activa ésta la remplazara...</p><a href="##" whycallme="A">Si, quiero activarla</a><a href="##">Cancelar</a></div><div class="confirm_side temporary_curriculum" type="temporary"><p>Confírme si desea mover esta currícula a temporales...</p><a href="##" whycallme="T">Si, quiero moverla a temporales</a><a href="##">Cancelar</a></div><div class="confirm_side close_curriculum" type="close"><p>Confírme si desea cerrar esta currícula...</p><a href="##" whycallme="C">Si, quiero cerrarla</a><a href="##">Cancelar</a></div></div>';$(i).prepend(a),f(c),h(j),h(i)},300)}else if("C"==a){var i=$("#curriculums"+n).find(".div_close"),j=$("#curriculum"+c).parent();$("#curriculum"+c).addClass("removeCurriculum"),setTimeout(function(){$("#curriculum"+c+", #curriculum_confirm"+c).remove();var a='<div id="curriculum'+c+'" class="curriculum" idactivatejs="'+c+'" state="C"><span>0</span><span>'+e.name+"</span><span>"+e.year+'</span><div class="modify close_modify"><a href="##">Ver Cursos</a><a href="##" ide="'+b+'" idjs="'+c+'" class="btnDetailCur" data-toggle="modal" data-target="#modalDetailCur" title="Mire los detalles de esta currícula...">Detalles</a></div></div>';$(i).prepend(a),f(c),h(j),h(i)},300)}else if("D"==a){var j=$("#curriculum"+c).parent();$("#curriculum"+c).addClass("removeCurriculum"),setTimeout(function(){$("#curriculum"+c+", #curriculum_confirm"+c).remove(),h(j)},300)}}},error:function(){}})}function j(){$("#formCurriculum").on("submit",function(a){a.preventDefault(),$("#idChargeSide").slideDown("fast");var b=$(this),c=$(this).find("input[type=submit]");c.attr("disabled","disabled").val("Guardando..."),$.ajax({type:"post",url:"/curricula/curricula/savenew",data:$(this).serialize(),dataType:"json",success:function(a){if(1===a.success){var d='<div class="curriculum" id="curriculum'+a.dataNew.idJs+'" state="B"><span>RC</span><span><span class="nameChangeEdit">'+a.dataNew.name+"</span> <small>"+a.dataNew.curid+"</small></span><span>Año "+a.dataNew.year+'</span><div class="modify draftModify"><a href="##" title="Administre los cursos correspondientes a esta currícula...">Administrar Cursos</a><a href="##" ide="'+a.dataNew.id+'" idjs="'+a.dataNew.idJs+'" class="btnDetailCur" data-toggle="modal" data-target="#modalDetailCur" title="Mire los detalles de esta currícula...">Detalles</a><a href="##" class="btn_derive" ide="'+a.dataNew.id+'" goto="'+a.dataNew.idJs+'">Derivar</a><a href="##" class="btn_delete" ide="'+a.dataNew.id+'" type="delete" goto="'+a.dataNew.idJs+'">Eliminar</a><div class="derive_from_draft" fromto="'+a.dataNew.idJs+'"><a href="##" type="active">Activar Curricula</a><a href="##" type="temporary">Mover a Temporales</a><a href="##" type="close">Cerrar Curricula</a></div></div></div><div id="curriculum_confirm'+a.dataNew.idJs+'" fromto="'+a.dataNew.idJs+'" class="confirms_side"><div class="confirm_side delete_curriculum" type="delete"><p>Confírme si desea eliminar esta currícula...</p><a href="##" whycallme="D">Si, quiero eliminarla</a><a href="##">Cancelar</a></div><div class="confirm_side active_curriculum" type="active"><p>Confírme si desea activar esta currícula, si hay otra activa ésta la remplazara...</p><a href="##" whycallme="A">Si, quiero activarla</a><a href="##">Cancelar</a></div><div class="confirm_side temporary_curriculum" type="temporary"><p>Confírme si desea mover esta currícula a temporales...</p><a href="##" whycallme="T">Si, quiero moverla a temporales</a><a href="##">Cancelar</a></div><div class="confirm_side close_curriculum" type="close"><p>Confírme si desea cerrar esta currícula...</p><a href="##" whycallme="C">Si, quiero cerrarla</a><a href="##">Cancelar</a></div></div>',e=$("#curriculums"+n).find(".div_draft");$(e).prepend(d),f(a.dataNew.idJs),h(e),$(b).find(".form-control").val(""),$("#idErrorsSide, #idChargeSide").slideUp("fast"),$("#idSuccessSide").slideDown("fast"),c.val("Guardado!"),clearTimeout(o),o=setTimeout(function(){$("#idSuccessSide").slideUp("fast"),$("#modalNewCur").modal("hide"),c.removeAttr("disabled").val("Guardar")},2e3),$("#curriculums"+n).find(".main_draft").slideDown("fast")}else if(0===a.success){$("#idChargeSide").slideUp("fast"),$("#idErrorsSide .errors").html(""),$("#idErrorsSide").removeClass("errorBase").addClass("errorData").slideDown("fast");for(var g=0;g<=a.errors.length-1;g++)$("#idErrorsSide .errors").append("<p>"+a.errors[g]+"</p>");clearTimeout(o),o=setTimeout(function(){$("#idErrorsSide").slideUp("fast")},7e3)}},error:function(){console.log("error de base de datos"),$("#idChargeSide").slideUp("fast"),$("#idErrorsSide").removeClass("errorData").addClass("errorBase").slideDown("fast"),$("#idErrorsSide .errors").html("<p>Ups! Parece que hubo un error, fijese que no haya otra currícula en el mismo año y periódo igual al que esta creando...</p>"),clearTimeout(o),o=setTimeout(function(){$("#idErrorsSide").slideUp("fast")},7e3)}}),c.removeAttr("disabled").val("Guardar")})}function k(a){$("#detailCur_btnEditCur").on("click",function(){$("#idDivDetailCurricula, #idHeaderDetail").fadeOut("fast",function(){$("#idDivEditCurriculum, #idHeaderEdit").fadeIn("fast")})}),$("#detailCur_edit_btnBackToDetail").on("click",function(){$("#idDivEditCurriculum, #idHeaderEdit").fadeOut("fast",function(){$("#idDivDetailCurricula, #idHeaderDetail").fadeIn("fast")})}),$("#detailCur_btnAdminCourses").on("click",function(){console.log("Administrar cursos")}),$("#idDivDetailCurricula").html('<br><br><br><center><img src="/img/spinner.gif" alt="Loading..." /></center>').load("/curricula/curricula/detailcurriculum/id/"+a,function(){l()}),$("#idDivEditCurriculum").html('<br><br><br><center><img src="/img/spinner.gif" alt="Loading..." /></center>').load("/curricula/curricula/editcurriculum/id/"+a,function(){m(a,q)})}function l(){console.log("para proximas acciones en esta vista, programar aqui :D")}function m(a,b){$("#formEditCurriculum").on("submit",function(c){c.preventDefault();var d=$(this).find("input[type=submit]"),e=$(this).find("input[name=name]").val();d.attr("disabled","disabled").val("Guardando..."),$.ajax({type:"post",url:"/curricula/curricula/saveedit",data:$(this).serialize(),dataType:"json",success:function(c){if(1===c.success)$("#idDivDetailCurricula").html('<br><br><br><center><img src="/img/spinner.gif" alt="Loading..." /></center>').load("/curricula/curricula/detailcurriculum/id/"+a,function(){l()}),$("#idDivEditCurriculum, #idHeaderEdit").fadeOut("fast",function(){$("#idDivDetailCurricula, #idHeaderDetail").fadeIn("fast")}),$("#curriculum"+b).find("span.nameChangeEdit").html(e);else if(0===c.success){$("#idErrorsSide_Edit .errors").html(""),$("#idErrorsSide_Edit").slideDown("fast");for(var d=0;d<=c.errors.length-1;d++)$("#idErrorsSide_Edit .errors").append("<p>"+c.errors[d]+"</p>");clearTimeout(o),o=setTimeout(function(){$("#idErrorsSide_Edit").slideUp("fast")},7e3)}else 2===c.success&&console.log("error de base de datos")},error:function(){console.log("error de base de datos")}}),d.removeAttr("disabled").val("Guardar")})}var n="",o="",p="",q="";return{chargeSchools:a,chargeCurriculums:b}}var b="",a=a(),c=$("#rol").val();"RC"==c?($("#selectFaculty").on("change",function(){b=$(this).val(),a.chargeSchools(b)}),$("#selectSchool").on("change",function(){b=$(this).val(),a.chargeCurriculums(b)})):"DR"==c&&(b=$("#school").val(),a.chargeCurriculums(b))});